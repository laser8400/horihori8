<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アメリカ主要都市クイズ</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        #game-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        #status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }
        #question-text {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #0056b3;
        }
        /* 地図表示エリア */
        #map-wrapper {
            position: relative;
            width: 100%;
            /* アスペクト比を維持するための設定 */
            max-width: 800px; 
            margin: 0 auto;
        }
        #map-image {
            width: 100%;
            height: auto;
            display: block;
            border: 2px solid #ddd;
            border-radius: 4px;
        }
        
        /* 地図上のピン（ドット） */
        .city-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #ff4757; /* デフォルトは赤系 */
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%); /* 中心を座標に合わせる */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: transform 0.2s, background-color 0.2s;
            z-index: 10;
        }
        .city-dot:hover {
            transform: translate(-50%, -50%) scale(1.3);
            background-color: #ff6b81;
        }

        /* 正解・不正解のアニメーション用クラス */
        .correct-anim {
            background-color: #2ed573 !important;
            transform: translate(-50%, -50%) scale(1.5);
            box-shadow: 0 0 15px #2ed573;
        }
        .wrong-anim {
            background-color: #57606f !important;
            opacity: 0.5;
        }

        #feedback {
            height: 30px;
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.2em;
        }
        .text-correct { color: #2ed573; }
        .text-wrong { color: #ff4757; }

        /* リザルト画面 */
        #result-screen {
            display: none;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #0056b3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #004494;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="quiz-screen">
        <div id="status-bar">
            <span id="score">スコア: 0</span>
            <span id="progress">残り: 0</span>
        </div>
        
        <div id="question-text">読み込み中...</div>

        <div id="map-wrapper">
            <img src="IMG_6534.jpeg" id="map-image" alt="アメリカ地図">
            <div id="dots-container"></div>
        </div>

        <div id="feedback"></div>
    </div>

    <div id="result-screen">
        <h2>結果発表</h2>
        <p id="final-score" style="font-size: 2em; margin: 30px 0;"></p>
        <button onclick="restartGame()">もう一度挑戦</button>
    </div>
</div>

<script>
    // 都市データ：座標(top, left)は画像の左上を(0,0)としたパーセンテージ
    // 注：画像のアスペクト比によって若干のズレが生じる可能性があるため、
    // 必要に応じて数値を微調整してください。
    const citiesData = [
        { name: "ニューヨーク", top: 28, left: 88 },
        { name: "ロサンゼルス", top: 58, left: 12 },
        { name: "シカゴ", top: 32, left: 68 },
        { name: "マイアミ", top: 86, left: 82 },
        { name: "シアトル", top: 12, left: 13 },
        { name: "ヒューストン", top: 78, left: 52 },
        { name: "サンフランシスコ", top: 46, left: 8 },
        { name: "ラスベガス", top: 52, left: 16 },
        { name: "ワシントンD.C.", top: 38, left: 82 },
        { name: "デンバー", top: 45, left: 35 }
    ];

    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let isAnswering = true; // 連打防止用

    // ゲームの初期化
    function initGame() {
        // 都市データをシャッフルして問題リストを作成
        currentQuestions = [...citiesData].sort(() => 0.5 - Math.random());
        // 全問やると長いので5問に制限（変更可能）
        currentQuestions = currentQuestions.slice(0, 5);
        
        currentQuestionIndex = 0;
        score = 0;
        isAnswering = true;

        document.getElementById('quiz-screen').style.display = 'block';
        document.getElementById('result-screen').style.display = 'none';
        
        updateStatus();
        loadQuestion();
    }

    // ステータス表示の更新
    function updateStatus() {
        document.getElementById('score').textContent = `スコア: ${score}`;
        document.getElementById('progress').textContent = `残り: ${currentQuestions.length - currentQuestionIndex}問`;
    }

    // 問題の読み込みとドットの配置
    function loadQuestion() {
        const targetCity = currentQuestions[currentQuestionIndex];
        document.getElementById('question-text').textContent = `「${targetCity.name}」はどこ？`;
        document.getElementById('feedback').textContent = "";
        
        const dotsContainer = document.getElementById('dots-container');
        dotsContainer.innerHTML = ''; // 前のドットを消去

        // 選択肢を用意する（正解1つ + ダミー2つ）
        let candidates = [targetCity];
        
        // ダミーの都市をランダムに選ぶ（正解以外から）
        let otherCities = citiesData.filter(c => c.name !== targetCity.name);
        // シャッフルして2つ選ぶ
        otherCities.sort(() => 0.5 - Math.random());
        candidates.push(otherCities[0]);
        candidates.push(otherCities[1]);

        // 候補（正解+ダミー）をシャッフルして表示順をランダムにする
        candidates.sort(() => 0.5 - Math.random());

        // ドットを生成して配置
        candidates.forEach(city => {
            const dot = document.createElement('div');
            dot.className = 'city-dot';
            dot.style.top = city.top + '%';
            dot.style.left = city.left + '%';
            
            // クリックイベント
            dot.onclick = () => checkAnswer(city, targetCity, dot);
            
            dotsContainer.appendChild(dot);
        });

        isAnswering = true;
    }

    // 正誤判定
    function checkAnswer(selectedCity, correctCity, dotElement) {
        if (!isAnswering) return;
        isAnswering = false;

        const feedback = document.getElementById('feedback');

        if (selectedCity.name === correctCity.name) {
            // 正解
            score += 10;
            feedback.textContent = "正解！";
            feedback.className = "text-correct";
            dotElement.classList.add('correct-anim');
        } else {
            // 不正解
            feedback.textContent = `残念！正解は別の場所でした。`;
            feedback.className = "text-wrong";
            dotElement.classList.add('wrong-anim');
            
            // 正解のドットを教えてあげる
            const dots = document.querySelectorAll('.city-dot');
            dots.forEach(d => {
                // 座標から正解のドットを探す（簡易的な判定）
                if (d.style.top === correctCity.top + '%' && d.style.left === correctCity.left + '%') {
                    d.classList.add('correct-anim');
                }
            });
        }

        updateStatus();

        // 次の問題へ
        setTimeout(() => {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuestions.length) {
                loadQuestion();
            } else {
                showResult();
            }
        }, 1500); // 1.5秒後に次へ
    }

    // 結果表示
    function showResult() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        document.getElementById('final-score').textContent = `${score}点 / ${currentQuestions.length * 10}点`;
    }

    // 再スタート
    function restartGame() {
        initGame();
    }

    // 初回起動
    window.onload = initGame;
</script>

</body>
</html>
