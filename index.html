<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ¡ãƒªã‚«éƒ½å¸‚ãƒ»åœ°å›³ã‚¯ã‚¤ã‚º</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f4f9;
            text-align: center;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        h1 { margin-bottom: 10px; }
        .info-panel {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        #question-text {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }
        #status-text {
            font-size: 1.1em;
            font-weight: bold;
            height: 1.5em; /* é«˜ã•ã‚’ç¢ºä¿ã—ã¦ã‚¬ã‚¿ã¤ãé˜²æ­¢ */
            margin-top: 10px;
        }
        /* åœ°å›³ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        #regions_div {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            background-color: #cce5ff; /* æµ·ã®è‰²ã£ã½ã */
        }
        .score-board {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        /* æ­£è§£ãƒ»ä¸æ­£è§£ã®è‰² */
        .text-correct { color: #28a745; }
        .text-wrong { color: #dc3545; }
        
        button#retry-btn {
            display: none;
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1.2em;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ‡ºğŸ‡¸ ã‚¢ãƒ¡ãƒªã‚«éƒ½å¸‚ãƒ»åœ°å›³ã‚¯ã‚¤ã‚º</h1>
    <p>è¡¨ç¤ºã•ã‚ŒãŸéƒ½å¸‚ãŒã‚ã‚‹å·ã‚’åœ°å›³ä¸Šã§ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>
    
    <div class="info-panel">
        <div id="question-text">èª­ã¿è¾¼ã¿ä¸­...</div>
        <div id="status-text"></div>
        <div class="score-board">ç¾åœ¨: <span id="current-score">0</span>ç‚¹ / <span id="current-q-num">0</span>å•ç›®</div>
    </div>

    <div id="regions_div"></div>
    
    <button id="retry-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦éŠã¶</button>
</div>

<script type="text/javascript">
    // Google Chartsã®ãƒ­ãƒ¼ãƒ‰
    google.charts.load('current', {
        'packages':['geochart'],
    });
    google.charts.setOnLoadCallback(drawRegionsMap);

    // ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ï¼ˆä¸»è¦20éƒ½å¸‚ï¼‰
    // codeã¯ISO 3166-2:USå½¢å¼ (US-XX)
    const quizData = [
        { city: "ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯ (New York City)", code: "US-NY", state: "ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯å·" },
        { city: "ãƒ­ã‚µãƒ³ã‚¼ãƒ«ã‚¹ (Los Angeles)", code: "US-CA", state: "ã‚«ãƒªãƒ•ã‚©ãƒ«ãƒ‹ã‚¢å·" },
        { city: "ã‚·ã‚«ã‚´ (Chicago)", code: "US-IL", state: "ã‚¤ãƒªãƒã‚¤å·" },
        { city: "ãƒ’ãƒ¥ãƒ¼ã‚¹ãƒˆãƒ³ (Houston)", code: "US-TX", state: "ãƒ†ã‚­ã‚µã‚¹å·" },
        { city: "ãƒã‚¤ã‚¢ãƒŸ (Miami)", code: "US-FL", state: "ãƒ•ãƒ­ãƒªãƒ€å·" },
        { city: "ã‚·ã‚¢ãƒˆãƒ« (Seattle)", code: "US-WA", state: "ãƒ¯ã‚·ãƒ³ãƒˆãƒ³å·" },
        { city: "ãƒ©ã‚¹ãƒ™ã‚¬ã‚¹ (Las Vegas)", code: "US-NV", state: "ãƒãƒãƒ€å·" },
        { city: "ãƒœã‚¹ãƒˆãƒ³ (Boston)", code: "US-MA", state: "ãƒã‚µãƒãƒ¥ãƒ¼ã‚»ãƒƒãƒ„å·" },
        { city: "ã‚¢ãƒˆãƒ©ãƒ³ã‚¿ (Atlanta)", code: "US-GA", state: "ã‚¸ãƒ§ãƒ¼ã‚¸ã‚¢å·" },
        { city: "ãƒ‡ãƒ³ãƒãƒ¼ (Denver)", code: "US-CO", state: "ã‚³ãƒ­ãƒ©ãƒ‰å·" },
        { city: "ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒ¼ãƒªãƒ³ã‚º (New Orleans)", code: "US-LA", state: "ãƒ«ã‚¤ã‚¸ã‚¢ãƒŠå·" },
        { city: "ãƒ‡ãƒˆãƒ­ã‚¤ãƒˆ (Detroit)", code: "US-MI", state: "ãƒŸã‚·ã‚¬ãƒ³å·" },
        { city: "ãƒ•ã‚£ãƒ©ãƒ‡ãƒ«ãƒ•ã‚£ã‚¢ (Philadelphia)", code: "US-PA", state: "ãƒšãƒ³ã‚·ãƒ«ãƒ™ãƒ‹ã‚¢å·" },
        { city: "ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹ (Phoenix)", code: "US-AZ", state: "ã‚¢ãƒªã‚¾ãƒŠå·" },
        { city: "ãƒŸãƒã‚¢ãƒãƒªã‚¹ (Minneapolis)", code: "US-MN", state: "ãƒŸãƒã‚½ã‚¿å·" },
        { city: "ãƒŠãƒƒã‚·ãƒ¥ãƒ“ãƒ« (Nashville)", code: "US-TN", state: "ãƒ†ãƒã‚·ãƒ¼å·" },
        { city: "ã‚½ãƒ«ãƒˆãƒ¬ã‚¤ã‚¯ã‚·ãƒ†ã‚£ (Salt Lake City)", code: "US-UT", state: "ãƒ¦ã‚¿å·" },
        { city: "ãƒãƒ¼ãƒˆãƒ©ãƒ³ãƒ‰ (Portland)", code: "US-OR", state: "ã‚ªãƒ¬ã‚´ãƒ³å·" },
        { city: "ã‚¢ãƒ³ã‚«ãƒ¬ãƒƒã‚¸ (Anchorage)", code: "US-AK", state: "ã‚¢ãƒ©ã‚¹ã‚«å·" },
        { city: "ãƒ›ãƒãƒ«ãƒ« (Honolulu)", code: "US-HI", state: "ãƒãƒ¯ã‚¤å·" }
    ];

    // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ç”¨é…åˆ—
    let shuffledQuiz = [];
    let currentIndex = 0;
    let score = 0;
    let chart; // ãƒãƒ£ãƒ¼ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    let isProcessing = false; // é€£æ‰“é˜²æ­¢ç”¨

    function drawRegionsMap() {
        // ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
        shuffledQuiz = [...quizData].sort(() => Math.random() - 0.5);
        currentIndex = 0;
        score = 0;

        // åœ°å›³ã®åˆæœŸåŒ–
        const data = google.visualization.arrayToDataTable([
            ['State', 'Selectable'],
            // å…¨ç±³ã®å·ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å®šç¾©ï¼ˆè‰²ã‚’ã¤ã‘ã‚‹ãŸã‚ï¼‰
            ['US-AL', 0], ['US-AK', 0], ['US-AZ', 0], ['US-AR', 0], ['US-CA', 0],
            ['US-CO', 0], ['US-CT', 0], ['US-DE', 0], ['US-FL', 0], ['US-GA', 0],
            ['US-HI', 0], ['US-ID', 0], ['US-IL', 0], ['US-IN', 0], ['US-IA', 0],
            ['US-KS', 0], ['US-KY', 0], ['US-LA', 0], ['US-ME', 0], ['US-MD', 0],
            ['US-MA', 0], ['US-MI', 0], ['US-MN', 0], ['US-MS', 0], ['US-MO', 0],
            ['US-MT', 0], ['US-NE', 0], ['US-NV', 0], ['US-NH', 0], ['US-NJ', 0],
            ['US-NM', 0], ['US-NY', 0], ['US-NC', 0], ['US-ND', 0], ['US-OH', 0],
            ['US-OK', 0], ['US-OR', 0], ['US-PA', 0], ['US-RI', 0], ['US-SC', 0],
            ['US-SD', 0], ['US-TN', 0], ['US-TX', 0], ['US-UT', 0], ['US-VT', 0],
            ['US-VA', 0], ['US-WA', 0], ['US-WV', 0], ['US-WI', 0], ['US-WY', 0]
        ]);

        const options = {
            region: 'US', // ã‚¢ãƒ¡ãƒªã‚«åˆè¡†å›½ã‚’è¡¨ç¤º
            resolution: 'provinces', // å·å¢ƒã‚’è¡¨ç¤º
            colorAxis: {colors: ['#white', '#white']}, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è‰²
            backgroundColor: '#cce5ff', // æµ·ã®è‰²
            datalessRegionColor: '#f5f5f5',
            defaultColor: '#f5f5f5',
            legend: 'none', // å‡¡ä¾‹ãªã—
            tooltip: { trigger: 'focus', isHtml: true } // ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®è¡¨ç¤ºåˆ¶å¾¡
        };

        chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

        // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ç™»éŒ²
        google.visualization.events.addListener(chart, 'regionClick', function(eventData) {
            checkAnswer(eventData.region);
        });

        chart.draw(data, options);
        showNextQuestion();
    }

    function showNextQuestion() {
        if (currentIndex < shuffledQuiz.length) {
            const q = shuffledQuiz[currentIndex];
            document.getElementById('question-text').textContent = `Q${currentIndex + 1}. ã€Œ${q.city}ã€ã¯ã©ã“ï¼Ÿ`;
            document.getElementById('status-text').textContent = "åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„";
            document.getElementById('status-text').className = "";
            document.getElementById('current-score').textContent = score;
            document.getElementById('current-q-num').textContent = currentIndex + 1;
            isProcessing = false;
        } else {
            endGame();
        }
    }

    function checkAnswer(clickedRegionCode) {
        if (isProcessing) return; // å‡¦ç†ä¸­ã¯ã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹
        isProcessing = true;

        const currentQ = shuffledQuiz[currentIndex];
        const statusEl = document.getElementById('status-text');

        // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸåœ°åŸŸã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: US-NYï¼‰ã¨æ­£è§£ã‚’æ¯”è¼ƒ
        if (clickedRegionCode === currentQ.code) {
            score++;
            statusEl.textContent = `æ­£è§£ï¼ (${currentQ.state})`;
            statusEl.className = "text-correct";
        } else {
            statusEl.textContent = `æ®‹å¿µ... æ­£è§£ã¯ ${currentQ.state} ã§ã—ãŸã€‚`;
            statusEl.className = "text-wrong";
        }

        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰æ¬¡ã®å•é¡Œã¸
        currentIndex++;
        setTimeout(showNextQuestion, 1500);
    }

    function endGame() {
        document.getElementById('question-text').textContent = "ã™ã¹ã¦ã®å•é¡ŒãŒçµ‚äº†ã—ã¾ã—ãŸï¼";
        document.getElementById('status-text').textContent = `ã‚ãªãŸã®ã‚¹ã‚³ã‚¢: ${score} / ${shuffledQuiz.length}`;
        document.getElementById('regions_div').style.display = "none";
        document.getElementById('retry-btn').style.display = "inline-block";
    }

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã«åœ°å›³ã‚’å†æç”»ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰
    window.addEventListener('resize', function() {
        if (chart) {
             // ç°¡æ˜“çš„ãªå†æç”»
             const data = google.visualization.arrayToDataTable([
                ['State', 'Val'],
                ['US-CA', 0] // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ¬æ¥ã¯ä¿æŒã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†ã¹ãã ãŒç°¡ç•¥åŒ–ï¼‰
             ]); 
             // â€»æœ¬æ ¼çš„ãªãƒªã‚µã‚¤ã‚ºå¯¾å¿œã«ã¯ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€
             // ä»Šå›ã¯ã‚¯ã‚¤ã‚ºé€²è¡Œä¸­ãªã®ã§ãƒªãƒ­ãƒ¼ãƒ‰æ¨å¥¨ã¨ã—ã¾ã™ã€‚
        }
    });

</script>

</body>
</html>
